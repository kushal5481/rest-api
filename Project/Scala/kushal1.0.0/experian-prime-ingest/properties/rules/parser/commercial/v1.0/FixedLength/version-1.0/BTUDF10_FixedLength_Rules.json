[
  {
    "rule_id": "R100001",
    "rule_name": "HEADER_FIRST_RECORD_IF_MANDATORY",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 1,
    "rule_action": "REJECT",
    "error_code": "HEADER_NOT_FIRST",
    "error_message": "Header must be first record when mandatory.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "NOT (SELECT segment_is_mandatory FROM header_constraints) OR ((SELECT lower(Type_of_Line) FROM df_raw ORDER BY CAST(split(RecordID,'-')[0] AS INT) ASC LIMIT 1) = 'header')",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-10",
    "metric_code": "M100001"
  },
  {
    "rule_id": "R100002",
    "rule_name": "HEADER_OCCURRENCE_ONCE",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 2,
    "rule_action": "REJECT",
    "error_code": "HEADER_COUNT_INVALID",
    "error_message": "Header must occur exactly once when mandatory; otherwise zero or one.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT segment_is_mandatory FROM header_constraints) THEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='header') = 1 ELSE (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='header') IN (0,1) END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-10",
    "metric_code": "M100002"
  },
  {
    "rule_id": "R100003",
    "rule_name": "HEADER_LENGTH_EQUALS_MAX",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 3,
    "rule_action": "REJECT",
    "error_code": "HEADER_LENGTH_MISMATCH",
    "error_message": "Header record length must equal Segment_Maximum_Length when mandatory.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT segment_is_mandatory FROM header_constraints) THEN (SELECT COUNT(*) FROM df_raw r JOIN header_constraints hc WHERE lower(r.Type_of_Line)='header' AND LENGTH(r.RawRecord) != hc.segment_max_length) = 0 ELSE TRUE END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-10",
    "metric_code": "M100003"
  },
  {
    "rule_id": "R200001",
    "rule_name": "FOOTER_LAST_RECORD_WHEN_MANDATORY",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 4,
    "rule_action": "REJECT",
    "error_code": "FOOTER_NOT_LAST",
    "error_message": "Footer must be present at the last record when mandatory.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "NOT (SELECT segment_is_mandatory FROM footer_constraints) OR ((SELECT lower(Type_of_Line) FROM df_raw ORDER BY CAST(split(RecordID,'-')[0] AS INT) DESC LIMIT 1) = 'footer')",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M200001"
  },
  {
    "rule_id": "R200002",
    "rule_name": "FOOTER_SINGLE_OCCURRENCE",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 5,
    "rule_action": "REJECT",
    "error_code": "FOOTER_OCCURRENCE_INVALID",
    "error_message": "Footer must occur exactly once when mandatory; optional files allow zero or one.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT segment_is_mandatory FROM footer_constraints) THEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='footer') = 1 ELSE (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='footer') IN (0,1) END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M200002"
  },
  {
    "rule_id": "R200003",
    "rule_name": "FOOTER_LENGTH_EQUALS_MAX",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 6,
    "rule_action": "REJECT",
    "error_code": "FOOTER_LENGTH_MISMATCH",
    "error_message": "Footer record length must equal Segment_Maximum_Length when mandatory.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT segment_is_mandatory FROM footer_constraints) THEN (SELECT COUNT(*) FROM df_raw r JOIN footer_constraints fc WHERE lower(r.Type_of_Line)='footer' AND LENGTH(r.RawRecord) != fc.segment_max_length) = 0 ELSE TRUE END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M200003"
  },
  {
    "rule_id": "R100004",
    "rule_name": "HEADER_MANDATORY_FIELDS_PRESENT_IN_ORDER",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 7,
    "rule_action": "REJECT",
    "error_code": "HD_FIELDS_MANDATORY_MISSING",
    "error_message": "All mandatory header fields must be present and non-empty in sequence.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='header')=0 THEN TRUE ELSE (SELECT COUNT(*) FROM df_raw r CROSS JOIN header_fields f WHERE lower(r.Type_of_Line)='header' AND f.field_is_mandatory='true' AND LENGTH(TRIM(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT)))) = 0) = 0 END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M100004"
  },
  {
    "rule_id": "R100005",
    "rule_name": "HEADER_EXPECTED_VALUES_CHECK",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 8,
    "rule_action": "REJECT",
    "error_code": "HD_FIELDS_EXPECTED_MISMATCH",
    "error_message": "Header fields with expected values must match one of the expected values.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='header')=0 THEN TRUE ELSE (SELECT MAX(CASE WHEN lower(r.Type_of_Line)='header' THEN CASE WHEN COALESCE(f.field_expected_values,'') = '' THEN 1 WHEN array_contains(transform(split(f.field_expected_values, ','), x -> lower(trim(x))), lower(trim(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT))))) THEN 1 ELSE 0 END END) FROM df_raw r CROSS JOIN header_fields f WHERE f.field_index='0') = 1 END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M100005"
  },
  {
    "rule_id": "R100006",
    "rule_name": "HEADER_LENGTH_MATCH_ALL_FIELDS",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 9,
    "rule_action": "REJECT",
    "error_code": "HD_FIELDS_LENGTH_MISMATCH",
    "error_message": "Each header field value length must equal Field_Maximum_Length.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='header')=0 THEN TRUE ELSE (SELECT COUNT(*) FROM df_raw r CROSS JOIN header_fields f WHERE lower(r.Type_of_Line)='header' AND LENGTH(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT))) <> CAST(f.field_max_length AS INT)) = 0 END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M100006"
  },
  {
    "rule_id": "R100007",
    "rule_name": "HEADER_FIELD_OCCURRENCE_MATCH",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 10,
    "rule_action": "REJECT",
    "error_code": "HD_FIELD_OCCURRENCE_INVALID",
    "error_message": "Header field occurrence must match Field_Occurrence for fixed-length (expected 1 each).",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='header') = 0 THEN TRUE ELSE NOT EXISTS (SELECT 1 FROM (SELECT f.field_tag, CAST(f.field_occurrence AS INT) AS expected_occurrence, COUNT(*) AS actual_occurrence FROM header_fields f CROSS JOIN df_raw r WHERE lower(r.Type_of_Line)='header' AND TRIM(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT))) != '' GROUP BY f.field_tag, f.field_occurrence) field_counts WHERE actual_occurrence != expected_occurrence) END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M100007"
  },
  {
    "rule_id": "R200004",
    "rule_name": "FOOTER_MANDATORY_FIELDS_PRESENT_IN_ORDER",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 11,
    "rule_action": "REJECT",
    "error_code": "TS_FIELDS_MANDATORY_MISSING",
    "error_message": "All mandatory footer fields must be present and non-empty in sequence.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='footer')=0 THEN TRUE ELSE (SELECT COUNT(*) FROM df_raw r CROSS JOIN footer_fields f WHERE lower(r.Type_of_Line)='footer' AND f.field_is_mandatory='true' AND LENGTH(TRIM(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT)))) = 0) = 0 END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M200004"
  },
  {
    "rule_id": "R200005",
    "rule_name": "FOOTER_EXPECTED_VALUES_CHECK",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 12,
    "rule_action": "REJECT",
    "error_code": "TS_FIELDS_EXPECTED_MISMATCH",
    "error_message": "Footer fields with expected values must match one of the expected values.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='footer')=0 THEN TRUE ELSE (SELECT MAX(CASE WHEN lower(r.Type_of_Line)='footer' THEN CASE WHEN COALESCE(f.field_expected_values,'') = '' THEN 1 WHEN array_contains(transform(split(f.field_expected_values, ','), x -> lower(trim(x))), lower(trim(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT))))) THEN 1 ELSE 0 END END) FROM df_raw r CROSS JOIN footer_fields f WHERE f.field_index='0') = 1 END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M200005"
  },
  {
    "rule_id": "R200006",
    "rule_name": "FOOTER_LENGTH_MATCH_ALL_FIELDS",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 13,
    "rule_action": "REJECT",
    "error_code": "TS_FIELDS_LENGTH_MISMATCH",
    "error_message": "Each footer field value length must equal Field_Maximum_Length.",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='footer')=0 THEN TRUE ELSE (SELECT COUNT(*) FROM df_raw r CROSS JOIN footer_fields f WHERE lower(r.Type_of_Line)='footer' AND LENGTH(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT))) <> CAST(f.field_max_length AS INT)) = 0 END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M200006"
  },
  {
    "rule_id": "R200007",
    "rule_name": "FOOTER_FIELD_OCCURRENCE_MATCH",
    "rule_level": "FILE",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 14,
    "rule_action": "REJECT",
    "error_code": "TS_FIELD_OCCURRENCE_INVALID",
    "error_message": "Footer field occurrence must match Field_Occurrence for fixed-length (expected 1 each).",
    "segment": [],
    "field_tag": [],
    "SQL_expression": "CASE WHEN (SELECT COUNT(*) FROM df_raw WHERE lower(Type_of_Line)='footer') = 0 THEN TRUE ELSE NOT EXISTS (SELECT 1 FROM (SELECT f.field_tag, CAST(f.field_occurrence AS INT) AS expected_occurrence, COUNT(*) AS actual_occurrence FROM footer_fields f CROSS JOIN df_raw r WHERE lower(r.Type_of_Line)='footer' AND TRIM(SUBSTRING(r.RawRecord, CAST(f.start_pos AS INT), CAST(f.field_max_length AS INT))) != '' GROUP BY f.field_tag, f.field_occurrence) field_counts WHERE actual_occurrence != expected_occurrence) END",
    "DSL_condition": null,
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M200007"
  },
  {
    "rule_id": "R300001",
    "rule_name": "SEGMENT_ORDER_MISMATCH",
    "rule_level": "RECORD",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 1,
    "rule_action": "REJECT",
    "error_code": "INVALID_SEGMENT_ORDER",
    "error_message": "Segment order must match the expected sequence defined in record structure.",
    "segment": [],
    "field_tag": [],
    "DSL_condition": null,
    "SQL_expression": "bs_count = 1 AND bs_pos = 1 AND rs_count >= 1 AND rs_pos > bs_pos AND cr_count >= 1 AND cr_pos > rs_pos AND gs_count >= 0 AND gs_before_cr_count = 0",
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-16",
    "metric_code": "M300001"
  },
  {
    "rule_id": "R500001",
    "rule_name": "FIELD_VALUE_LENGTH_MISMATCH",
    "rule_level": "FIELD",
    "rule_engine_type": "SQL",
    "rule_type": "MANDATORY",
    "rule_category": "STRUCTURAL",
    "rule_status": "ACTIVE",
    "error_type": "FATAL",
    "severity": "CRITICAL",
    "rule_stage": "PARSER",
    "rule_priority": 1,
    "rule_action": "REJECT",
    "error_code": "INVALID_LENGTH",
    "error_message": "Mandatory Field value length must not exceed defined maximum length.",
    "segment": [],
    "field_tag": [],
    "DSL_condition": null,
    "SQL_expression": "is_mandatory = TRUE AND field_value IS NOT NULL AND LENGTH(TRIM(field_value)) > 0 AND LENGTH(field_value) <= max_field_length",
    "expected_value_source": "NONE",
    "expected_values": [],
    "spec_date": "2025-DEC-23",
    "metric_code": "M500001"
  }
]